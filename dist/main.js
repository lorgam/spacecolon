!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const o={context:null,hasToExit:!1,screenStack:[],width:1e3,height:750,mainScreenWidth:800,mainScreenHeight:600,topMenuHeight:25,tileSize:16,minTileSize:16,maxTileSize:64,menuFont:"30px Arial",normalFont:"14px Arial",backgroundColor:"#000000",textColor:"#FFFFFF",highlightColor:"#FF0000",horizontalTilesToShow:function(){return o.mainScreenWidth/o.tileSize},verticalTilesToShow:function(){return o.mainScreenHeight/o.tileSize},bottomOfMap:function(){return o.topMenuHeight+o.mainScreenHeight},rightMenuSize:function(){return o.width-o.mainScreenWidth},lowerMenuSize:function(){return o.height-o.bottomOfMap()},fontHeight:function(){return parseInt(o.context.font.match(/\d+/))}};var n=o;const r={keyboard:{aux:{}},mouse:{clicked:!1,x:0,y:0},init:function(){r.keyboard.ARROW_LEFT=new a(37),r.keyboard.ARROW_UP=new a(38),r.keyboard.ARROW_RIGHT=new a(39),r.keyboard.ARROW_DOWN=new a(40),r.keyboard.ENTER=new a(13),r.keyboard.ALT=new a(18),r.keyboard.ESC=new a(27),r.keyboard.O=new a(79),r.keyboard.V=new a(86)},keyDown:function(t){var e=r.keyboard.aux[t];e&&e.keyDown()},mouseClick:function(t,e){r.mouse.clicked=!0,r.mouse.x=t,r.mouse.y=e},isClicked:function(){return!!r.mouse.clicked&&(r.mouse.clicked=!1,!0)}};function a(t){this.isPressed=!1,this.keyCode=t,r.keyboard.aux[t]=this}a.prototype.keyDown=function(){this.isPressed=!0},a.prototype.execute=function(){return!!this.isPressed&&(this.isPressed=!1,!0)};var h=r;const s={language:"en",en:{mainMenu:{start:"Start",options:"Options",exit:"Exit"},optionsMenu:{language:"Language",tileSize:"Tile Size",little:"Little",medium:"Medium",big:"Big"},materials:{mineral:"mineral",gas:"gas"}},es:{mainMenu:{start:"Empezar",options:"Opciones",exit:"Salir"},optionsMenu:{language:"Idioma",tileSize:"Tamaño de cuadricula",little:"Pequeño",medium:"Mediano",big:"Grande"},materials:{mineral:"mineral",gas:"gas"}},getText:function(t,e){return s[s.language][t][e]}};var l=s;const p={gradient:0,getGrey:function(t){return Math.lerp(0,255,t)},updateGradient:function(t){p.gradient=.5*Math.sin(.003*t)+.5},readUserLanguage:function(){if(navigator&&navigator.languages)for(var t in navigator.languages)for(var e in l)if(e==navigator.languages[t])return void(l.language=e)}};Math.lerp=function(t,e,i){return t+i*(e-t)};var c=p;function u(){this.selectedOption=0,this.optionArray=[]}u.prototype.update=function(t){h.keyboard.ESC.execute()&&n.screenStack.length>1&&n.screenStack.shift(),h.keyboard.ENTER.execute()&&this.optionArray[this.selectedOption].execute(),h.keyboard.ARROW_UP.execute()&&(this.selectedOption=(this.selectedOption+this.optionArray.length-1)%this.optionArray.length),h.keyboard.ARROW_DOWN.execute()&&(this.selectedOption=(this.selectedOption+1)%this.optionArray.length),h.keyboard.ARROW_RIGHT.execute()&&this.optionArray[this.selectedOption].nextOption(),h.keyboard.ARROW_LEFT.execute()&&this.optionArray[this.selectedOption].previousOption()},u.prototype.padding=2,u.prototype.draw=function(){var t=n.context;t.fillStyle=n.backgroundColor,t.fillRect(0,0,n.width,n.height),t.fillStyle=n.textColor,t.font=n.menuFont;var e,i,o=n.fontHeight(),r=(o+2*this.padding)*this.optionArray.length,a=(n.height-r)/2+this.padding+o;for(var h in this.optionArray){if(e=this.optionArray[h].getText(this.section),i=t.measureText(e).width,this.selectedOption==h){var s=Math.lerp(0,128,c.gradient);t.fillStyle="rgb(255,"+s+","+s+")",t.fillText(e,(n.width-i)/2,a),t.fillStyle=n.textColor}else t.fillText(e,(n.width-i)/2,a);a+=2*this.padding+o}},u.prototype.addButton=function(t,e){this.optionArray.push(new g(t,e))},u.prototype.addSelection=function(t,e,i){var o=n[i];for(var r in e)if(e[r].value==o)return void this.optionArray.push(new y(t,e,r,i))},u.prototype.addLanguageSelection=function(){var t=l.language,e=[{value:"en",text:"English"},{value:"es",text:"Español"}];for(var i in e)if(e[i].value==t)return void this.optionArray.push(new m(e,i))};var d=u;function f(t){this.text=t}function g(t,e){f.call(this,t),this.function_pointer=e}function y(t,e,i,o){f.call(this,t),this.options=e,this.selectedOption=i,this.attribute=o}function m(t,e){y.call(this,"language",t,e)}function S(){d.call(this),this.section="optionsMenu",this.addSelection("tileSize",[{value:16,text:"little"},{value:32,text:"medium"},{value:64,text:"big"}],"tileSize"),this.addLanguageSelection()}f.prototype.getText=function(t){return l.getText(t,this.text)},f.prototype.execute=function(){},f.prototype.nextOption=function(){},f.prototype.previousOption=function(){},g.prototype=Object.create(f.prototype),g.prototype.execute=function(){this.function_pointer()},y.prototype=Object.create(f.prototype),y.prototype.changeValue=function(){n[this.attribute]=this.options[this.selectedOption].value},y.prototype.nextOption=function(){this.selectedOption=(this.selectedOption+1)%this.options.length,this.changeValue()},y.prototype.previousOption=function(){this.selectedOption=(this.options.length+this.selectedOption-1)%this.options.length,this.changeValue()},y.prototype.getText=function(t){return"<- "+l.getText(t,this.text)+" : "+l.getText(t,this.options[this.selectedOption].text)+" ->"},m.prototype=Object.create(y.prototype),m.prototype.changeValue=function(){l.language=this.options[this.selectedOption].value},m.prototype.getText=function(t){return"<- "+l.getText(t,this.text)+" : "+this.options[this.selectedOption].text+" ->"},S.prototype=Object.create(d.prototype);var w=S;function x(){}x.prototype.noise=function(t,e,i){var o=255&Math.floor(t),n=255&Math.floor(e),r=255&Math.floor(i);t-=Math.floor(t),e-=Math.floor(e),i-=Math.floor(i);var a=this.fade(t),h=this.fade(e),s=this.fade(i),l=this.p[o]+n,p=this.p[l]+r,c=this.p[l+1]+r,u=this.p[o+1]+n,d=this.p[u]+r,f=this.p[u+1]+r;return Math.lerp(Math.lerp(Math.lerp(this.grad(this.p[p],t,e,i),this.grad(this.p[d],t-1,e,i),a),Math.lerp(this.grad(this.p[c],t,e-1,i),this.grad(this.p[f],t-1,e-1,i),a),h),Math.lerp(Math.lerp(this.grad(this.p[p+1],t,e,i-1),this.grad(this.p[d+1],t-1,e,i-1),a),Math.lerp(this.grad(this.p[c+1],t,e-1,i-1),this.grad(this.p[f+1],t-1,e-1,i-1),a),h),s)},x.prototype.fade=function(t){return t*t*t*(t*(6*t-15)+10)},x.prototype.grad=function(t,e,i,o){var n=15&t,r=n<8?e:i,a=n<4?i:12==n||14==n?e:o;return(0==(1&n)?r:-r)+(0==(2&n)?a:-a)},x.prototype.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var v=x;const T={MINERAL:{id:1,color:"#DC444F",text:"mineral",default:100},GAS:{id:2,color:"#CB8F1E",text:"gas",default:0}};var M=T;function k(t,e,i){this.parent=t,this.heightSeed=e,this.humiditySeed=i,this.height=.5*this.heightSeed+.5,this.type=this.tileType(this.parent.options.waterHeight),this.resource=null}T.generateResources=function(t){var e,i,o,r,a=t.mapCanvas.getContext("2d"),h=t.options.width*t.options.height;for(r=~~(.0015*h);r>0;)if(e=~~(Math.random()*t.options.width),i=~~(Math.random()*t.options.height),(o=t.map[e][i]).height>t.options.waterHeight+.15){if(o.resource)continue;r--,o.resource=T.MINERAL,a.fillStyle=T.MINERAL.color,a.fillRect(e*n.maxTileSize,i*n.maxTileSize,n.maxTileSize,n.maxTileSize)}for(r=~~(5e-4*h);r>0;)if(e=~~(Math.random()*t.options.width),i=~~(Math.random()*t.options.height),(o=t.map[e][i]).height<t.options.waterHeight+.15){if(o.resource)continue;r--,o.resource=T.GAS,a.fillStyle=T.GAS.color,a.fillRect(e*n.maxTileSize,i*n.maxTileSize,n.maxTileSize,n.maxTileSize)}},k.prototype.tileTypes={deepOcean:{color:"#072253"},ocean:{color:"#12326E"},shallowWaters:{color:"#1F4487"},beach:{color:"#FFCF75"},highMountain:{color:"#7A0009"},desert:{color:"#E2AB46"},grass:{color:"#71D361"},forest:{color:"#1B880A"},desertMountain:{color:"#7D5100"},grassMountain:{color:"#4BBB3A"},forestMountain:{color:"#0E6700"}},k.prototype.tileType=function(t){if(this.height<t-.25)return"deepOcean";if(this.height<t-.05)return"ocean";if(this.height<t)return"shallowWaters";if(this.height<t+.013)return"beach";if(this.height>.85)return"highMountain";var e=.8-t;return this.height<.6*e+t?this.humiditySeed<-.4?"desert":this.humiditySeed<.5?"grass":"forest":this.humiditySeed<-.4?"desertMountain":this.humiditySeed<.5?"grassMountain":"forestMountain"},k.prototype.mapColor=function(){return this.tileTypes[this.type].color},k.prototype.heightGray=function(){var t=c.getGrey(this.height);return"rgb("+t+","+t+","+t+")"},k.prototype.humidityGray=function(){var t=c.getGrey(.5*this.humiditySeed+.5);return"rgb("+t+","+t+","+t+")"},k.prototype.texture=function(){return this.tileTypes[this.type].canvas};var O=k;const b={generate:function(t){b.generateWorld(t),M.generateResources(t)},generateWorld:function(t){var e=document.createElement("canvas");e.width=t.options.width*n.maxTileSize,e.height=t.options.height*n.maxTileSize;for(var i,o,r,a,h,s,l,p,c,u=e.getContext("2d"),d=new v,f=.04+.05*Math.random(),g=.075+.05*Math.random(),y=2*Math.PI/t.options.width,m=t.options.width/8,S=0,w=new Array(t.options.width),x=0;x<t.options.width;x++){w[x]=new Array(t.options.height),p=m*Math.sin(S),c=m*Math.cos(S),i=f*p+t.options.heightSeedX,o=f*c+t.options.heightSeedZ,r=g*p+t.options.humiditySeedX,a=g*c+t.options.humiditySeedZ;for(var T=0;T<t.options.height;T++)h=d.noise(i,T*f+t.options.heightSeedY,o),s=d.noise(r,T*g+t.options.humiditySeedY,a),l=new O(t,h,s),w[x][T]=l,u.fillStyle=l.mapColor(),u.fillRect(x*n.maxTileSize,T*n.maxTileSize,n.maxTileSize,n.maxTileSize);S+=y}t.map=w,t.mapCanvas=e},generateOptions:function(t){var e=20+~~(10*Math.random()),i={};return i.width=4*e,i.height=3*e,"normal"==t.type&&(i.waterHeight=.35+.2*Math.random(),i.heightSeedX=Math.random(),i.heightSeedY=Math.random(),i.heightSeedZ=Math.random(),i.humiditySeedX=Math.random(),i.humiditySeedY=Math.random(),i.humiditySeedZ=Math.random()),i}};var z=b;const C={normalMapView:function(t){var e=n.context,i=n.horizontalTilesToShow(),o=n.verticalTilesToShow();e.drawImage(t.mapCanvas,t.topLeftX*n.maxTileSize,t.topLeftY*n.maxTileSize,i*n.maxTileSize,o*n.maxTileSize,0,n.topMenuHeight,n.mainScreenWidth,n.mainScreenHeight);var r=t.options.width-t.topLeftX;r<i&&(e.drawImage(t.mapCanvas,0,t.topLeftY*n.maxTileSize,i*n.maxTileSize,o*n.maxTileSize,r*n.tileSize,n.topMenuHeight,n.mainScreenWidth,n.mainScreenHeight),r+=t.map.width)},heightMapView:function(t){var e,i,o,r,a,h=n.context,s=n.horizontalTilesToShow(),l=n.verticalTilesToShow();for(e=0;e<s;e++)for(r=e*n.tileSize,i=0;i<l;i++)a=i*n.tileSize+n.topMenuHeight,o=t.map[(t.topLeftX+e)%t.options.width][(t.topLeftY+i)%t.options.height],h.fillStyle=o.heightGray(),h.fillRect(r,a,n.tileSize,n.tileSize)},humidityMapView:function(t){var e,i,o,r,a,h=n.context,s=n.horizontalTilesToShow(),l=n.verticalTilesToShow();for(e=0;e<s;e++)for(r=e*n.tileSize,i=0;i<l;i++)a=i*n.tileSize+n.topMenuHeight,o=t.map[(t.topLeftX+e)%t.options.width][(t.topLeftY+i)%t.options.height],h.fillStyle=o.humidityGray(),h.fillRect(r,a,n.tileSize,n.tileSize)},blockMapView:function(t){var e,i,o,r,a,h=n.context,s=n.horizontalTilesToShow(),l=n.verticalTilesToShow();for(e=0;e<s;e++)for(r=e*n.tileSize,i=0;i<l;i++)a=i*n.tileSize+n.topMenuHeight,o=t.map[(t.topLeftX+e)%t.options.width][(t.topLeftY+i)%t.options.height],h.fillStyle=o.mapColor(),h.fillRect(r,a,n.tileSize,n.tileSize)}};C.drawArray=[C.normalMapView,C.heightMapView,C.humidityMapView,C.blockMapView];var L=C;var R={draw:function(t){if(t){var e=n.context;e.fillStyle=n.textColor,e.font=n.normalFont;var i,o,r=n.fontHeight();i=n.bottomOfMap()+n.topMenuHeight,o=t.type,e.fillText(o,15,i),i+=r,o="Height: "+t.height,e.fillText(o,15,i),i+=r,o="Humidity: "+t.humiditySeed,e.fillText(o,15,i),t.resource&&(i+=r,o=l.getText("materials",t.resource.text),e.fillText(o,15,i))}}};var A={draw:function(t){var e=n.context;e.fillStyle=n.backgroundColor,e.fillRect(n.mainScreenWidth,0,n.width,n.height)}};const W={draw:function(t){var e=n.context;e.drawImage(t.mapCanvas,n.mainScreenWidth,n.bottomOfMap(),n.width-n.mainScreenWidth,n.height-n.bottomOfMap());var i=n.rightMenuSize()/t.options.width,o=n.lowerMenuSize()/t.options.height,r=n.mainScreenWidth+t.topLeftX*i,a=n.bottomOfMap()+t.topLeftY*o,h=n.horizontalTilesToShow()*i,s=n.verticalTilesToShow()*o,l=Math.lerp(.7,1,c.gradient);e.strokeStyle="rgba(0,0,0,"+l+")",e.strokeRect(r,a,h,s);var p=r+h-n.width;p>0&&e.strokeRect(n.mainScreenWidth,a,p,s)},mouseClick:function(t,e,i){t.centerView(~~(e/n.rightMenuSize()*t.options.width),~~(i/n.lowerMenuSize()*t.options.height))}};var E=W;function H(t){this.options=t,z.generate(this),this.tileClicked=null,this.topLeftX=0,this.topLeftY=0,this.typeOfView=0}H.prototype.draw=function(){var t=n.context;t.fillStyle=n.backgroundColor,t.fillRect(0,0,n.width,n.height),L.drawArray[this.typeOfView](this),R.draw(this.getTileClicked()),A.draw(),E.draw(this)},H.prototype.update=function(t){h.keyboard.ESC.execute()&&n.screenStack.shift(),h.keyboard.ARROW_LEFT.execute()&&this.moveLeft(),h.keyboard.ARROW_RIGHT.execute()&&this.moveRight(),h.keyboard.ARROW_UP.execute()&&this.moveUp(),h.keyboard.ARROW_DOWN.execute()&&this.moveDown(),h.keyboard.V.execute()&&this.changeView(),h.isClicked()&&(h.mouse.x<n.mainScreenWidth?h.mouse.y>n.topMenuHeight&&h.mouse.y<n.bottomOfMap()&&this.mouseClick(h.mouse.x,h.mouse.y-n.topMenuHeight):h.mouse.y>=n.bottomOfMap()&&E.mouseClick(this,h.mouse.x-n.mainScreenWidth,h.mouse.y-n.bottomOfMap()))},H.prototype.mouseClick=function(t,e){var i=(~~(t/n.tileSize)+this.topLeftX)%this.options.width,o=(~~(e/n.tileSize)+this.topLeftY)%this.options.height;this.tileClicked&&this.tileClicked.x==i&&this.tileClicked.y==o?this.tileClicked=null:this.tileClicked={x:i,y:o}},H.prototype.moveLeft=function(){this.topLeftX=(this.options.width+this.topLeftX-1)%this.options.width},H.prototype.moveRight=function(){this.topLeftX=(this.topLeftX+1)%this.options.width},H.prototype.moveUp=function(){this.topLeftY>0&&(this.topLeftY=this.topLeftY-1)},H.prototype.moveDown=function(){this.topLeftY+n.verticalTilesToShow()<this.options.height&&(this.topLeftY=this.topLeftY+1)},H.prototype.changeView=function(){this.typeOfView=(this.typeOfView+1)%L.drawArray.length},H.prototype.getTileClicked=function(){return this.tileClicked?this.map[this.tileClicked.x][this.tileClicked.y]:null},H.prototype.centerView=function(t,e){this.topLeftX=(~~(t-n.horizontalTilesToShow()/2)+this.options.width)%this.options.width,this.topLeftY=~~(e-n.verticalTilesToShow()/2),this.topLeftY<0?this.topLeftY=0:this.topLeftY+n.verticalTilesToShow()>this.options.height&&(this.topLeftY=this.options.height-n.verticalTilesToShow())};var Y=H;var F={load:function(){var t,e;for(var i in O.prototype.tileTypes)(e=document.createElement("canvas")).width=100,e.height=100,(t=e.getContext("2d")).fillStyle=O.prototype.tileTypes[i].color,t.fillRect(0,0,100,100),O.prototype.tileTypes[i].canvas=e}};function V(){this.totalTime=0,this.worldMap=new Y(z.generateOptions({type:"normal"})),this.currentState=this.worldMap,F.load(),h.isClicked()}V.prototype.update=function(t){this.totalTime+=t,h.keyboard.O.execute()?n.screenStack.unshift(new w):this.currentState.update(t)},V.prototype.draw=function(){this.currentState.draw()};var _=V;function X(){d.call(this),this.section="mainMenu",this.addButton("start",function(){n.screenStack.unshift(new _)}),this.addButton("options",function(){n.screenStack.unshift(new w)})}X.prototype=Object.create(d.prototype);var G=X,P=0;function I(t){var e=t-P;P=t,c.updateGradient(t),n.screenStack[0].draw(),n.screenStack[0].update(e),!n.hasToExit&&n.screenStack.length>0?window.requestAnimationFrame(I):console.log("Game over")}window.onload=function(){n.hasToExit=!1,c.readUserLanguage();var t=document.getElementById("main_canvas");n.context=t.getContext("2d"),n.screenStack.unshift(new G),h.init(),document.onkeydown=function(t){h.keyDown(t.keyCode)},t.addEventListener("click",function(e){h.mouseClick(e.pageX-t.offsetLeft,e.pageY-t.offsetTop)},!1),window.requestAnimationFrame(I)}}]);